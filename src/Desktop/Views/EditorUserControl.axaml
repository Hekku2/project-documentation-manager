<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:Desktop.ViewModels"
             xmlns:conv="clr-namespace:Desktop.Converters"
             xmlns:controls="clr-namespace:Desktop.Controls"
             xmlns:models="clr-namespace:Desktop.Models"
             xmlns:views="clr-namespace:Desktop.Views"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="Desktop.Views.EditorUserControl"
             x:DataType="vm:EditorViewModel">

    <Grid>
        <Grid.RowDefinitions>
            <!-- Tab Bar -->
            <RowDefinition Height="40" />
            <!-- Editor Content -->
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        
        <!-- Tab Bar -->
        <Border Grid.Row="0" Background="#2D2D30" BorderBrush="#3E3E42" BorderThickness="0,0,0,1">
            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                <ItemsControl ItemsSource="{Binding EditorTabBar.EditorTabs}" Margin="5,0">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="vm:EditorTabViewModel">
                            <Border Name="TabBorder"
                                    Background="{Binding IsActive, Converter={x:Static conv:BoolToColorConverter.Instance}}"
                                    BorderBrush="#3E3E42"
                                    BorderThickness="0,0,1,0" 
                                    Margin="0,0,0,0">
                                <Button Name="TabButton"
                                        Command="{Binding SelectCommand}"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Padding="0"
                                        HorizontalContentAlignment="Stretch"
                                        VerticalContentAlignment="Stretch">
                                    <Button.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="Show preview" Command="{Binding ShowPreviewCommand}" IsVisible="{Binding IsMarkdownTemplate}">
                                                <MenuItem.Icon>
                                                    <Path Width="16" Height="16" Fill="#CCCCCC" Data="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z" />
                                                </MenuItem.Icon>
                                            </MenuItem>
                                            <MenuItem Header="Close" Command="{Binding CloseCommand}" />
                                        </ContextMenu>
                                    </Button.ContextMenu>
                                    <StackPanel Orientation="Horizontal" Margin="15,6">
                                        <TextBlock Name="TabTitle"
                                                   Text="{Binding DisplayTitle}" 
                                                   Foreground="#CCCCCC" 
                                                   VerticalAlignment="Center" />
                                        <Button Content="Ã—" 
                                                Command="{Binding CloseCommand}"
                                                Background="Transparent" 
                                                Foreground="#CCCCCC" 
                                                BorderThickness="0" 
                                                Margin="8,0,0,0" 
                                                Padding="2" 
                                                FontSize="14"
                                                VerticalAlignment="Center" />
                                    </StackPanel>
                                </Button>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>
        
        <!-- Editor Content with DataTemplates -->
        <ContentControl Grid.Row="1" Content="{Binding EditorContent.CurrentContentData}">
            <ContentControl.DataTemplates>
                <!-- File Editor Template -->
                <DataTemplate DataType="models:FileEditorContentData">
                    <views:FileEditorContent />
                </DataTemplate>
                
                <!-- Settings Editor Template -->
                <DataTemplate DataType="models:SettingsEditorContentData">
                    <views:SettingsEditorContent DataContext="{Binding SettingsViewModel}" />
                </DataTemplate>
                
                <!-- File Preview Template -->
                <DataTemplate DataType="models:FilePreviewContentData">
                    <views:FilePreviewContent />
                </DataTemplate>
            </ContentControl.DataTemplates>
        </ContentControl>
    </Grid>
</UserControl>